<%- include('partials/header') %>

<div class="bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="flex mb-8" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="/" class="text-gray-700 hover:text-primary">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <a href="/products" class="text-gray-700 hover:text-primary">Products</a>
                    </div>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <a href="/products/category/<%= product.category %>" class="text-gray-700 hover:text-primary capitalize"><%= product.category %></a>
                    </div>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <span class="text-gray-500"><%= product.name %></span>
                    </div>
                </li>
            </ol>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <!-- Product Image -->
            <div class="space-y-4">
                <div class="aspect-w-1 aspect-h-1 bg-white rounded-lg overflow-hidden">
                    <img src="/images/<%= product.image %>" alt="<%= product.name %>" 
                         class="w-full h-96 object-cover object-center">
                </div>
            </div>

            <!-- Product Info -->
            <div class="space-y-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2"><%= product.name %></h1>
                    
                    <!-- Rating -->
                    <div class="flex items-center mb-4">
                        <div class="flex text-yellow-400">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <i class="fas fa-star <%= i <= Math.floor(product.rating) ? '' : 'text-gray-300' %>"></i>
                            <% } %>
                        </div>
                        <span class="text-sm text-gray-600 ml-2">(<%= product.rating.toFixed(1) %>) â€¢ <%= product.reviews ? product.reviews.length : 0 %> reviews</span>
                    </div>
                    
                    <!-- Price -->
                    <!-- <div class="mb-6">
                        <span class="text-3xl font-bold text-primary">$<%= product.price.toFixed(2) %></span>
                        <% if (product.originalPrice && product.originalPrice > product.price) { %>
                        <span class="text-lg text-gray-500 line-through ml-2">$<%= product.originalPrice.toFixed(2) %></span>
                        <span class="text-sm text-green-600 ml-2">Save $<%= (product.originalPrice - product.price).toFixed(2) %></span>
                        <% } %>
                    </div> -->
                </div>

                <!-- Description -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Description</h3>
                    <p class="text-gray-600 leading-relaxed"><%= product.description %></p>
                </div>

                <!-- Add to Cart Form -->
                <form id="add-to-cart-form" class="space-y-4">
                    <input type="hidden" name="productId" value="<%= product._id %>">
                    
                    <!-- Size Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Size</label>
                        <select name="size" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <% if (product.sizes && product.sizes.length > 0) { %>
                                <% product.sizes.forEach(size => { %>
                                <option value="<%= size %>"><%= size %></option>
                                <% }) %>
                            <% } else { %>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            <% } %>
                        </select>
                    </div>

                    <!-- Color Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                        <select name="color" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <% if (product.colors && product.colors.length > 0) { %>
                                <% product.colors.forEach(color => { %>
                                <option value="<%= color %>"><%= color %></option>
                                <% }) %>
                            <% } else { %>
                                <option value="Black">Black</option>
                                <option value="White">White</option>
                                <option value="Red">Red</option>
                                <option value="Blue">Blue</option>
                            <% } %>
                        </select>
                    </div>

                    <!-- Quantity -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                        <div class="flex items-center space-x-3">
                            <button type="button" id="decrease-qty" class="w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100">
                                <i class="fas fa-minus text-sm"></i>
                            </button>
                            <input type="number" name="quantity" id="quantity" value="1" min="1" max="10" 
                                   class="w-20 px-3 py-2 text-center border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <button type="button" id="increase-qty" class="w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100">
                                <i class="fas fa-plus text-sm"></i>
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mt-1"><%= product.stock || 22 %> in stock</p>
                    </div>

                    <!-- Add to Cart Button -->
                    <button type="submit" class="w-full bg-primary hover:bg-red-700 text-white font-bold py-4 px-6 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-shopping-cart mr-2"></i>
                        Add to Cart
                    </button>
                </form>

                <!-- Product Features -->
                <div class="border-t pt-6">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-undo text-primary mr-2"></i>
                            30-day returns
                        </div>
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-shield-alt text-primary mr-2"></i>
                            2-year warranty
                        </div>
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-headset text-primary mr-2"></i>
                            24/7 support
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <% if (relatedProducts && relatedProducts.length > 0) { %>
        <div class="mt-16">
            <h2 class="text-2xl font-bold text-gray-900 mb-8">Related Products</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <% relatedProducts.forEach(relatedProduct => { %>
                <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover">
                    <div class="aspect-w-16 aspect-h-12">
                        <img src="/images/<%= relatedProduct.image %>" alt="<%= relatedProduct.name %>" class="w-full h-48 object-cover">
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= relatedProduct.name %></h3>
                        <div class="flex items-center justify-between">
                            <!-- <span class="text-xl font-bold text-primary">$<%= relatedProduct.price.toFixed(2) %></span> -->
                            <a href="/products/<%= relatedProduct._id %>" class="bg-primary hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
                <% }) %>
            </div>
        </div>
        <% } %>
    </div>
</div>

<script>
// Quantity controls
document.getElementById('decrease-qty').addEventListener('click', function() {
    const qtyInput = document.getElementById('quantity');
    const currentValue = parseInt(qtyInput.value);
    if (currentValue > 1) {
        qtyInput.value = currentValue - 1;
    }
});

document.getElementById('increase-qty').addEventListener('click', function() {
    const qtyInput = document.getElementById('quantity');
    const currentValue = parseInt(qtyInput.value);
    const maxValue = parseInt(qtyInput.getAttribute('max'));
    if (currentValue < maxValue) {
        qtyInput.value = currentValue + 1;
    }
});

// Add to cart functionality
document.getElementById('add-to-cart-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {};
    formData.forEach((value, key) => {
        data[key] = value;
    });
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding to Cart...';
    submitBtn.disabled = true;
    
    fetch('/cart/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update cart count in header
            const cartCount = document.querySelector('#cart-count');
            if (cartCount && data.cartCount) {
                cartCount.textContent = data.cartCount;
            }
            
            // Show success message
            submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Added to Cart!';
            submitBtn.classList.remove('bg-primary', 'hover:bg-red-700');
            submitBtn.classList.add('bg-green-600');
            
            // Reset button after 2 seconds
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.classList.remove('bg-green-600');
                submitBtn.classList.add('bg-primary', 'hover:bg-red-700');
                submitBtn.disabled = false;
            }, 2000);
        } else {
            throw new Error(data.error || 'Failed to add item to cart');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to add item to cart. Please try again.');
        
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});
</script>

<%- include('partials/footer') %>

