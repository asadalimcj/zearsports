<%- include('partials/header') %>

<div class="bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">My Account</h1>
            <p class="text-gray-600">Welcome back, <%= user.firstName %>!</p>
        </div>
        
        <!-- Success/Error Messages -->
        <% if (typeof success !== 'undefined' && success) { %>
        <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <div class="flex items-center">
                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                <p class="text-green-800"><%= success %></p>
            </div>
        </div>
        <% } %>
        
        <% if (typeof error !== 'undefined' && error) { %>
        <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                <p class="text-red-800"><%= error %></p>
            </div>
        </div>
        <% } %>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Profile Information -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Profile Information</h2>
                    <form action="/users/profile" method="POST" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                <input type="text" name="firstName" value="<%= user.firstName %>" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                <input type="text" name="lastName" value="<%= user.lastName %>" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" value="<%= user.email %>" disabled
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100">
                            <p class="text-sm text-gray-600 mt-1">Email cannot be changed</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input type="tel" name="phone" value="<%= user.phone || '' %>"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <h3 class="text-lg font-medium text-gray-900 mt-6 mb-4">Address</h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                            <input type="text" name="street" value="<%= user.address ? user.address.street || '' : '' %>"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                <input type="text" name="city" value="<%= user.address ? user.address.city || '' : '' %>"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                                <input type="text" name="state" value="<%= user.address ? user.address.state || '' : '' %>"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                                <input type="text" name="zipCode" value="<%= user.address ? user.address.zipCode || '' : '' %>"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                                <input type="text" name="country" value="<%= user.address ? user.address.country || '' : '' %>"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-primary hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            Update Profile
                        </button>
                    </form>
                </div>
                
                <!-- Change Password -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Change Password</h2>
                    <form action="/users/change-password" method="POST" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                            <input type="password" name="currentPassword" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                            <input type="password" name="newPassword" required minlength="6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                            <input type="password" name="confirmNewPassword" required minlength="6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <button type="submit" class="bg-primary hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            Change Password
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Account Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Account Summary</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Member Since</span>
                            <span class="font-medium"><%= new Date(user.createdAt).toLocaleDateString() %></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Orders</span>
                            <span class="font-medium"><%= orders.length %></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Account Status</span>
                            <span class="font-medium text-green-600">Active</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Actions</h2>
                    <div class="space-y-3">
                        <a href="/products" class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors text-center">
                            Browse Products
                        </a>
                        <a href="/cart" class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors text-center">
                            View Cart
                        </a>
                        <form action="/users/logout" method="POST" class="w-full">
                            <button type="submit" class="w-full bg-red-100 hover:bg-red-200 text-red-800 font-medium py-2 px-4 rounded-lg transition-colors">
                                Logout
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Orders -->
        <% if (orders && orders.length > 0) { %>
        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Recent Orders</h2>
            <div class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 px-2">Order ID</th>
                            <th class="text-left py-3 px-2">Date</th>
                            <th class="text-left py-3 px-2">Items</th>
                            <!-- <th class="text-left py-3 px-2">Total</th> -->
                            <!-- <th class="text-left py-3 px-2">Status</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <% orders.forEach(order => { %>
                        <tr class="border-b border-gray-100">
                            <td class="py-3 px-2 font-mono text-sm">#<%= order._id.toString().slice(-8) %></td>
                            <td class="py-3 px-2"><%= new Date(order.createdAt).toLocaleDateString() %></td>
                            <td class="py-3 px-2"><%= order.items.length %> items</td>
                            <!-- <td class="py-3 px-2 font-medium">$<%= order.total.toFixed(2) %></td> -->
                            <!-- <td class="py-3 px-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                                    <%= order.status || 'Pending' %>
                                </span>
                            </td> -->
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>

